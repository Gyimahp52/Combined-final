const sharp=require("sharp"),fs=require("fs"),path=require("path"),express=require("express"),inputDir=path.join(__dirname,"image"),outputDir=path.join(__dirname,"optimized");fs.existsSync(outputDir)||fs.mkdirSync(outputDir,{recursive:!0});const optimizeImages=async()=>{const t=fs.readdirSync(inputDir).filter(e=>/\.(jpg|jpeg|png)$/i.test(e));for(const e of t){const o=path.join(inputDir,e),a=path.join(outputDir,e);try{await sharp(o).resize(800).jpeg({quality:80}).toFile(a),console.log(`Optimized: ${e}`)}catch(r){console.error(`Error optimizing ${e}:`,r.message)}}},displayImages=()=>{const i=express();i.use("/optimized",express.static(outputDir)),i.get("/",(e,o)=>{const n=`
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Optimized Images</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 20px; }
          .gallery { display: flex; flex-wrap: wrap; gap: 20px; }
          .gallery img { width: 200px; height: auto; border: 1px solid #ddd; border-radius: 4px; padding: 5px; }
          .gallery img:hover { box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        </style>
      </head>
      <body>
        <h1>Optimized Images Gallery</h1>
        <div class="gallery">
          ${fs.readdirSync(outputDir).filter(s=>/\.(jpg|jpeg|png)$/i.test(s)).map(s=>`<img src="/optimized/${s}" alt="${s}">`).join("")}
        </div>
      </body>
      </html>
    `;o.send(n)});const t=3e3;i.listen(t,()=>{console.log(`Server is running at http://localhost:${t}`)})};(async()=>(console.log("Optimizing images..."),await optimizeImages(),console.log("Image optimization complete."),console.log("Starting server to display images..."),displayImages()))();
